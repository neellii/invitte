<?php
$loadAfter = file_get_contents("php://input");
if(is_numeric($loadAfter)) {
  $moreTemplates = db()->query("SELECT * FROM templates WHERE id > ? ORDER BY id ASC LIMIT 10", [(int)$loadAfter])->findAll();
}

if(check_auth()) {
  $likesEn = db()->query("SELECT liked from users WHERE id = ?", [$_SESSION['user']['id']])->getColumn();
  $likesDec = json_decode($likesEn);
  $likedTemplates = explode(":", $likesDec);
}
$finalhtml = '';

foreach ($moreTemplates as $template) {
  $html = '<div class="card-body">';
  $html .= '<img class="card-img" src="assets/img/templateimgs/template-' . $template['id'] . '.png" alt="template">';
  $html .= '<div class="card-title">
  <div class="btns">';
  $html .= '<a target="_blank" href="demo/' . $template["id"] .'">демо</a>
  <a href="templates/try/' . $template["id"] . '">
    попробовать
  </a></div>';
  if(check_auth()) {
   if(!empty($likedTemplates) && in_array($template['id'], $likedTemplates)) {
    $html .= '<svg data-template="' . $template['id'] . '" class="heart-svg" width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path class="red-svg" fill-rule="evenodd" clip-rule="evenodd" d="M14.7628 0.609329C15.9142 0.379834 17.1078 0.497857 18.1919 0.948399L18.2025 0.952792C18.9016 1.26231 19.5385 1.69683 20.0818 2.23481L19.73 2.59012L20.086 2.23898C20.6305 2.79102 21.0662 3.44076 21.37 4.15418L21.3726 4.16032C21.9693 5.61468 21.9693 7.24553 21.3726 8.6999L21.3708 8.70432C21.069 9.42027 20.6324 10.0715 20.0846 10.6226L20.0836 10.6237L10.9989 19.7084L3.01646 11.6737L3.01531 11.6725L1.96646 10.6237C0.854258 9.51147 0.229431 8.003 0.229431 6.43012C0.229431 4.85723 0.854259 3.34876 1.96646 2.23656C3.07866 1.12436 4.58712 0.499535 6.16001 0.499535C7.7329 0.499535 9.24137 1.12436 10.3536 2.23656L10.3622 2.24518L11.0137 2.92947L11.7287 2.23434C12.5568 1.40415 13.6128 0.838557 14.7628 0.609329ZM19.3761 2.94334C18.921 2.49319 18.3879 2.1294 17.8029 1.86964C16.9033 1.49701 15.9133 1.39968 14.9583 1.59004C14.0014 1.78077 13.1228 2.2517 12.4343 2.94298L12.4286 2.94866L10.9863 4.35076L9.64225 2.93947C8.71799 2.01743 7.4657 1.49953 6.16001 1.49953C4.85234 1.49953 3.59823 2.01901 2.67356 2.94367C1.7489 3.86833 1.22943 5.12244 1.22943 6.43012C1.22943 7.73779 1.7489 8.9919 2.67356 9.91656L3.72472 10.9677L11.0012 18.2919L19.3754 9.91764C19.3755 9.91749 19.3752 9.9178 19.3754 9.91764C19.8319 9.4582 20.1964 8.91493 20.4483 8.31822C20.9439 7.1086 20.944 5.75261 20.4487 4.54291C20.1945 3.94725 19.8307 3.40465 19.3761 2.94334Z"></path>
    </svg>';
   } else {
    $html .= '<svg data-template="' . $template['id'] . '" class="heart-svg" width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M14.7628 0.609329C15.9142 0.379834 17.1078 0.497857 18.1919 0.948399L18.2025 0.952792C18.9016 1.26231 19.5385 1.69683 20.0818 2.23481L19.73 2.59012L20.086 2.23898C20.6305 2.79102 21.0662 3.44076 21.37 4.15418L21.3726 4.16032C21.9693 5.61468 21.9693 7.24553 21.3726 8.6999L21.3708 8.70432C21.069 9.42027 20.6324 10.0715 20.0846 10.6226L20.0836 10.6237L10.9989 19.7084L3.01646 11.6737L3.01531 11.6725L1.96646 10.6237C0.854258 9.51147 0.229431 8.003 0.229431 6.43012C0.229431 4.85723 0.854259 3.34876 1.96646 2.23656C3.07866 1.12436 4.58712 0.499535 6.16001 0.499535C7.7329 0.499535 9.24137 1.12436 10.3536 2.23656L10.3622 2.24518L11.0137 2.92947L11.7287 2.23434C12.5568 1.40415 13.6128 0.838557 14.7628 0.609329ZM19.3761 2.94334C18.921 2.49319 18.3879 2.1294 17.8029 1.86964C16.9033 1.49701 15.9133 1.39968 14.9583 1.59004C14.0014 1.78077 13.1228 2.2517 12.4343 2.94298L12.4286 2.94866L10.9863 4.35076L9.64225 2.93947C8.71799 2.01743 7.4657 1.49953 6.16001 1.49953C4.85234 1.49953 3.59823 2.01901 2.67356 2.94367C1.7489 3.86833 1.22943 5.12244 1.22943 6.43012C1.22943 7.73779 1.7489 8.9919 2.67356 9.91656L3.72472 10.9677L11.0012 18.2919L19.3754 9.91764C19.3755 9.91749 19.3752 9.9178 19.3754 9.91764C19.8319 9.4582 20.1964 8.91493 20.4483 8.31822C20.9439 7.1086 20.944 5.75261 20.4487 4.54291C20.1945 3.94725 19.8307 3.40465 19.3761 2.94334Z"></path>
          </svg>';
   }
  } else {
    $html .= '<svg class="like-notice" width="22" height="20" viewBox="0 0 22 20" fill="#000" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M14.7628 0.609329C15.9142 0.379834 17.1078 0.497857 18.1919 0.948399L18.2025 0.952792C18.9016 1.26231 19.5385 1.69683 20.0818 2.23481L19.73 2.59012L20.086 2.23898C20.6305 2.79102 21.0662 3.44076 21.37 4.15418L21.3726 4.16032C21.9693 5.61468 21.9693 7.24553 21.3726 8.6999L21.3708 8.70432C21.069 9.42027 20.6324 10.0715 20.0846 10.6226L20.0836 10.6237L10.9989 19.7084L3.01646 11.6737L3.01531 11.6725L1.96646 10.6237C0.854258 9.51147 0.229431 8.003 0.229431 6.43012C0.229431 4.85723 0.854259 3.34876 1.96646 2.23656C3.07866 1.12436 4.58712 0.499535 6.16001 0.499535C7.7329 0.499535 9.24137 1.12436 10.3536 2.23656L10.3622 2.24518L11.0137 2.92947L11.7287 2.23434C12.5568 1.40415 13.6128 0.838557 14.7628 0.609329ZM19.3761 2.94334C18.921 2.49319 18.3879 2.1294 17.8029 1.86964C16.9033 1.49701 15.9133 1.39968 14.9583 1.59004C14.0014 1.78077 13.1228 2.2517 12.4343 2.94298L12.4286 2.94866L10.9863 4.35076L9.64225 2.93947C8.71799 2.01743 7.4657 1.49953 6.16001 1.49953C4.85234 1.49953 3.59823 2.01901 2.67356 2.94367C1.7489 3.86833 1.22943 5.12244 1.22943 6.43012C1.22943 7.73779 1.7489 8.9919 2.67356 9.91656L3.72472 10.9677L11.0012 18.2919L19.3754 9.91764C19.3755 9.91749 19.3752 9.9178 19.3754 9.91764C19.8319 9.4582 20.1964 8.91493 20.4483 8.31822C20.9439 7.1086 20.944 5.75261 20.4487 4.54291C20.1945 3.94725 19.8307 3.40465 19.3761 2.94334Z"></path>
        </svg>
        <div class="register-notice">
          зарегистрируйтесь, чтобы добавить в избранное
        </div>';
  }
  $html .= '</div>
    <div class="card-buy">
      <p>1600₽/3000₽</p>
      <form action="templates/topayment" method="post">
        <input type="hidden" name="id" value="' . $template['id'] . '">
        <button class="buy-btn" type="submit">приобрести</button>
      </form>
    </div>
  </div>';
  $finalhtml = $finalhtml .= $html;
}
echo $finalhtml;